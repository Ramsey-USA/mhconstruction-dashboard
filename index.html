<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MH Construction Project Dashboard</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-hard-hat"></i>
                <h1>MH Construction Dashboard</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> Export to Excel
                </button>
                <button class="btn btn-secondary" onclick="generateDailyEmails()">
                    <i class="fas fa-envelope"></i> Send Daily Reports
                </button>
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span>Project Engineer</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
        <!-- Navigation -->
    <nav class="nav-tabs">
        <button class="nav-tab active" onclick="showTabSafe('dashboard', this)">
            <i class="fas fa-chart-line"></i> Dashboard
        </button>
        <button class="nav-tab" onclick="showTabSafe('projects', this)">
            <i class="fas fa-building"></i> Projects
        </button>
        <button class="nav-tab" onclick="showTabSafe('communications', this)">
            <i class="fas fa-comments"></i> Communications
        </button>
        <button class="nav-tab" onclick="showTabSafe('prospects', this)">
            <i class="fas fa-handshake"></i> Prospects
        </button>
        <button class="nav-tab" onclick="showTabSafe('stakeholders', this)">
            <i class="fas fa-users"></i> Stakeholders
        </button>
        <button class="nav-tab" onclick="showTabSafe('emails', this)">
            <i class="fas fa-envelope"></i> Email Setup
        </button>
        <button class="nav-tab" onclick="showTabSafe('microsoft365', this)">
            <i class="fab fa-microsoft"></i> Microsoft 365
        </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Critical Alerts -->
            <section class="alerts-section">
                <h2><i class="fas fa-exclamation-triangle"></i> Critical Alerts</h2>
                <div id="critical-alerts" class="alerts-container">
                    <!-- Alerts will be populated by JavaScript -->
                </div>
            </section>

            <!-- Quick Stats -->
            <section class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-building"></i></div>
                        <div class="stat-info">
                            <h3 id="active-projects">0</h3>
                            <p>Active Projects</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <div class="stat-info">
                            <h3 id="pending-items">0</h3>
                            <p>Pending Items</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-exclamation-circle"></i></div>
                        <div class="stat-info">
                            <h3 id="overdue-items">0</h3>
                            <p>Overdue Items</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-week"></i></div>
                        <div class="stat-info">
                            <h3 id="due-this-week">0</h3>
                            <p>Due This Week</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Upcoming Deadlines -->
            <section class="deadlines-section">
                <h2><i class="fas fa-calendar-alt"></i> Upcoming Deadlines</h2>
                <div id="upcoming-deadlines" class="deadlines-container">
                    <!-- Deadlines will be populated by JavaScript -->
                </div>
            </section>

            <!-- Recent Activity -->
            <section class="activity-section">
                <h2><i class="fas fa-history"></i> Recent Activity</h2>
                <div id="recent-activity" class="activity-container">
                    <!-- Activity will be populated by JavaScript -->
                </div>
            </section>
        </div>

        <!-- Projects Tab -->
        <div id="projects" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-building"></i> Projects</h2>
                <button class="btn btn-primary" onclick="showAddProjectModal()">
                    <i class="fas fa-plus"></i> Add Project
                </button>
            </div>
            <div id="projects-grid" class="projects-grid">
                <!-- Projects will be populated by JavaScript -->
            </div>
        </div>

        <!-- Communications Tab -->
        <div id="communications" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-comments"></i> Communications</h2>
                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="dashboard.clearCommunicationFilters()" title="Clear all filters">
                        <i class="fas fa-filter"></i> Clear Filters
                    </button>
                    <button class="btn btn-primary" onclick="showAddCommunicationModal()">
                        <i class="fas fa-plus"></i> Add Communication
                    </button>
                </div>
            </div>
            
            <!-- Enhanced Filters -->
            <div class="filters">
                <div class="filter-group">
                    <label class="filter-label">Project</label>
                    <select id="project-filter" onchange="dashboard.filterCommunications()">
                        <option value="">All Projects</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Type</label>
                    <select id="type-filter" onchange="dashboard.filterCommunications()">
                        <option value="">All Types</option>
                        <option value="RFI">üîç RFI</option>
                        <option value="Submittal">üìã Submittal</option>
                        <option value="Change Order">üìù Change Order</option>
                        <option value="Lien Release">‚úÖ Lien Release</option>
                        <option value="General">üí¨ General</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select id="status-filter" onchange="dashboard.filterCommunications()">
                        <option value="">All Status</option>
                        <option value="Pending">‚è≥ Pending</option>
                        <option value="In Progress">üîÑ In Progress</option>
                        <option value="Completed">‚úÖ Completed</option>
                        <option value="Overdue">‚ö†Ô∏è Overdue</option>
                    </select>
                </div>
            </div>

            <div id="communications-list" class="communications-list">
                <!-- Communications will be populated by JavaScript -->
            </div>
        </div>

        <!-- Prospects Tab -->
        <div id="prospects" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-handshake"></i> Prospects</h2>
                <div class="section-actions">
                    <button class="btn btn-info" onclick="syncAllProspectDates()" title="Sync all prospect dates to Outlook Calendar">
                        <i class="fas fa-calendar-plus"></i> Sync All to Calendar
                    </button>
                    <button class="btn btn-primary" onclick="showAddProspectModal()">
                        <i class="fas fa-plus"></i> Add Prospect
                    </button>
                </div>
            </div>
            <div id="prospects-list" class="prospects-list">
                <!-- Prospects will be populated by JavaScript -->
            </div>
        </div>

        <!-- Stakeholders Tab -->
        <div id="stakeholders" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> Stakeholders</h2>
                <button class="btn btn-primary" onclick="showAddStakeholderModal()">
                    <i class="fas fa-plus"></i> Add Stakeholder
                </button>
            </div>
            <div id="stakeholders-list" class="stakeholders-list">
                <!-- Stakeholders will be populated by JavaScript -->
            </div>
        </div>

        <!-- Email Setup Tab -->
        <div id="emails" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-mail-bulk"></i> Daily Email Setup</h2>
            </div>
            
            <div class="email-setup">
                <div class="email-recipients">
                    <h3>Email Recipients</h3>
                    <button class="btn btn-primary" onclick="showAddRecipientModal()">
                        <i class="fas fa-plus"></i> Add Recipient
                    </button>
                    <div id="email-recipients-list" class="recipients-list">
                        <!-- Recipients will be populated by JavaScript -->
                    </div>
                </div>

                <div class="email-preview">
                    <h3>Email Preview</h3>
                    <select id="preview-recipient" onchange="updateEmailPreview()">
                        <option value="">Select recipient to preview</option>
                    </select>
                    <div id="email-preview-content" class="email-content">
                        <!-- Preview content will be populated by JavaScript -->
                    </div>
                </div>

                <div class="email-settings">
                    <h3>Email Settings</h3>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="auto-send-enabled"> 
                            Enable automatic sending at 5:00 PM
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            Send time: 
                            <input type="time" id="send-time" value="17:00">
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            Your email signature:
                            <textarea id="email-signature" rows="4" placeholder="Enter your email signature..."></textarea>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Microsoft 365 Integration Tab -->
        <div id="microsoft365" class="tab-content">
            <div class="section-header">
                <h2><i class="fab fa-microsoft"></i> Microsoft 365 Integration</h2>
            </div>
            
            <div class="microsoft365-setup">
                <div class="connection-status">
                    <h3>Connection Status</h3>
                    <div id="microsoft365-status" class="status-card">
                        <div class="status-item">
                            <span class="status-label">Authentication:</span>
                            <span id="auth-status" class="status-value">Checking...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">OneDrive Backup:</span>
                            <span id="onedrive-status" class="status-value">Checking...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Outlook Integration:</span>
                            <span id="outlook-status" class="status-value">Checking...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Auto Backup:</span>
                            <span id="autobackup-status" class="status-value">Checking...</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="testMicrosoft365Connection()">
                        <i class="fas fa-plug"></i> Test Connection
                    </button>
                </div>

                <div class="onedrive-backup">
                    <h3>OneDrive Backup</h3>
                    <p>Automatically backup your dashboard data to Microsoft OneDrive for secure cloud storage.</p>
                    
                    <div class="backup-actions">
                        <button class="btn btn-success" onclick="backupToOneDrive()">
                            <i class="fas fa-cloud-upload-alt"></i> Backup Now
                        </button>
                        <button class="btn btn-secondary" onclick="listOneDriveBackups()">
                            <i class="fas fa-list"></i> View Backups
                        </button>
                    </div>
                    
                    <div id="backup-history" class="backup-history">
                        <!-- Backup history will be populated here -->
                    </div>
                </div>

                <div class="outlook-integration">
                    <h3>Outlook Email Integration</h3>
                    <p>Send daily status emails directly through Microsoft Outlook using Graph API.</p>
                    
                    <div class="outlook-features">
                        <div class="feature-item">
                            <i class="fas fa-envelope"></i>
                            <span>Automatic email sending via Outlook</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-calendar"></i>
                            <span>Create calendar events for project deadlines</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-users"></i>
                            <span>Access company address book</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="testOutlookIntegration()">
                        <i class="fas fa-paper-plane"></i> Test Email Integration
                    </button>
                </div>

                <div class="setup-instructions">
                    <h3>Setup Instructions</h3>
                    <div class="instruction-card">
                        <h4>1. Azure App Registration</h4>
                        <p>Register your application in Azure Active Directory to get credentials.</p>
                        <ul>
                            <li>Go to <a href="https://portal.azure.com" target="_blank">Azure Portal</a></li>
                            <li>Navigate to "App registrations" ‚Üí "New registration"</li>
                            <li>Set redirect URI to: <code>http://localhost:3000/auth/callback</code></li>
                            <li>Grant permissions: Mail.Send, Files.ReadWrite, Calendars.ReadWrite</li>
                        </ul>
                    </div>
                    
                    <div class="instruction-card">
                        <h4>2. Environment Configuration</h4>
                        <p>Set these environment variables on your server:</p>
                        <div class="code-block">
                            <code>
                                MICROSOFT_CLIENT_ID=your-app-client-id<br>
                                MICROSOFT_CLIENT_SECRET=your-app-client-secret<br>
                                MICROSOFT_TENANT_ID=your-tenant-id<br>
                                ONEDRIVE_SYNC=true<br>
                                OUTLOOK_INTEGRATION=true<br>
                                AUTO_BACKUP=true<br>
                                BACKUP_INTERVAL_HOURS=24
                            </code>
                        </div>
                    </div>
                    
                    <div class="instruction-card">
                        <h4>3. Company Admin Consent</h4>
                        <p>Your IT administrator needs to grant consent for the application to access company Microsoft 365 resources.</p>
                        <button class="btn btn-info" onclick="openAdminConsentUrl()">
                            <i class="fas fa-shield-alt"></i> Generate Admin Consent URL
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    
    <!-- Add Project Modal -->
    <div id="add-project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Project</h3>
                <span class="close" onclick="closeModal('add-project-modal')">&times;</span>
            </div>
            <form id="add-project-form">
                <div class="form-group">
                    <label>Project Number:</label>
                    <input type="text" id="project-number" required>
                </div>
                <div class="form-group">
                    <label>Project Name:</label>
                    <input type="text" id="project-name" required>
                </div>
                <div class="form-group">
                    <label>Client:</label>
                    <input type="text" id="project-client" required>
                </div>
                <div class="form-group">
                    <label>Project Manager:</label>
                    <select id="project-manager" required>
                        <option value="">Select PM</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Superintendent:</label>
                    <select id="project-superintendent">
                        <option value="">Select Superintendent</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Start Date:</label>
                    <input type="date" id="project-start-date" required>
                </div>
                <div class="form-group">
                    <label>End Date:</label>
                    <input type="date" id="project-end-date" required>
                </div>
                <div class="form-group">
                    <label>Contract Value:</label>
                    <input type="number" id="project-value" step="0.01">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-project-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Project</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Communication Modal -->
    <div id="add-communication-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Communication</h3>
                <span class="close" onclick="closeModal('add-communication-modal')">&times;</span>
            </div>
            <form id="add-communication-form">
                <div class="form-group">
                    <label>Project:</label>
                    <select id="comm-project" required>
                        <option value="">Select Project</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Stakeholder:</label>
                    <select id="comm-stakeholder" required>
                        <option value="">Select Stakeholder</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Type:</label>
                    <select id="comm-type" required>
                        <option value="">Select Type</option>
                        <option value="RFI">RFI</option>
                        <option value="Submittal">Submittal</option>
                        <option value="Change Order">Change Order</option>
                        <option value="Lien Release">Lien Release</option>
                        <option value="General">General</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Subject/Description:</label>
                    <input type="text" id="comm-subject" required>
                </div>
                <div class="form-group">
                    <label>Notes:</label>
                    <textarea id="comm-notes" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Priority:</label>
                    <select id="comm-priority">
                        <option value="Low">Low</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="High">High</option>
                        <option value="Critical">Critical</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Due Date:</label>
                    <input type="date" id="comm-due-date">
                </div>
                <div class="form-group">
                    <label>Status:</label>
                    <select id="comm-status">
                        <option value="Pending" selected>Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-communication-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Communication</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Prospect Modal -->
    <div id="add-prospect-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Prospect</h3>
                <span class="close" onclick="closeModal('add-prospect-modal')">&times;</span>
            </div>
            <form id="add-prospect-form">
                <div class="form-group">
                    <label>Prospect Name:</label>
                    <input type="text" id="prospect-name" required>
                </div>
                <div class="form-group">
                    <label>Client:</label>
                    <input type="text" id="prospect-client" required>
                </div>
                <div class="form-group">
                    <label>Estimator:</label>
                    <select id="prospect-estimator">
                        <option value="">Select Estimator</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Walk Date:</label>
                    <input type="date" id="prospect-walk-date">
                </div>
                <div class="form-group">
                    <label>Proposal Due Date:</label>
                    <input type="date" id="prospect-due-date">
                </div>
                <div class="form-group">
                    <label>Estimated Value:</label>
                    <input type="number" id="prospect-value" step="0.01">
                </div>
                <div class="form-group">
                    <label>Win Probability (%):</label>
                    <input type="number" id="prospect-probability" min="0" max="100" value="50">
                </div>
                <div class="form-group">
                    <label>Notes:</label>
                    <textarea id="prospect-notes" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-prospect-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Prospect</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Stakeholder Modal -->
    <div id="add-stakeholder-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Stakeholder</h3>
                <span class="close" onclick="closeModal('add-stakeholder-modal')">&times;</span>
            </div>
            <form id="add-stakeholder-form">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="stakeholder-name" required>
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="stakeholder-role" required>
                        <option value="">Select Role</option>
                        <option value="Project Manager">Project Manager</option>
                        <option value="Superintendent">Superintendent</option>
                        <option value="Estimator">Estimator</option>
                        <option value="Subcontractor">Subcontractor</option>
                        <option value="Client">Client</option>
                        <option value="Architect">Architect</option>
                        <option value="Engineer">Engineer</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Company:</label>
                    <input type="text" id="stakeholder-company">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="stakeholder-email">
                </div>
                <div class="form-group">
                    <label>Phone:</label>
                    <input type="tel" id="stakeholder-phone">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="stakeholder-receives-emails">
                        Receives daily status emails
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-stakeholder-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Stakeholder</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Email Recipient Modal -->
    <div id="add-recipient-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Email Recipient</h3>
                <span class="close" onclick="closeModal('add-recipient-modal')">&times;</span>
            </div>
            <form id="add-recipient-form">
                <div class="form-group">
                    <label>Stakeholder:</label>
                    <select id="recipient-stakeholder" required>
                        <option value="">Select Stakeholder</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Projects to Include:</label>
                    <div id="recipient-projects" class="checkbox-group">
                        <!-- Projects will be populated by JavaScript -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Send Time:</label>
                    <input type="time" id="recipient-send-time" value="17:00">
                </div>
                <div class="form-group">
                    <label>Frequency:</label>
                    <select id="recipient-frequency">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-recipient-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Recipient</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo">
                    <i class="fas fa-hard-hat"></i>
                    <span>MH Construction</span>
                </div>
                <p class="footer-description">
                    Professional construction project management dashboard designed to streamline communications, track progress, and enhance team collaboration.
                </p>
            </div>
            
            <div class="footer-section">
                <h4>Features</h4>
                <ul class="footer-links">
                    <li><i class="fas fa-check"></i> Project Management</li>
                    <li><i class="fas fa-check"></i> Communication Tracking</li>
                    <li><i class="fas fa-check"></i> Stakeholder Management</li>
                    <li><i class="fas fa-check"></i> Automated Reporting</li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h4>Support</h4>
                <ul class="footer-links">
                    <li><a href="#"><i class="fas fa-question-circle"></i> Help Center</a></li>
                    <li><a href="#"><i class="fas fa-book"></i> Documentation</a></li>
                    <li><a href="#"><i class="fas fa-envelope"></i> Contact Support</a></li>
                    <li><a href="#"><i class="fas fa-phone"></i> Call Support</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h4>Integration</h4>
                <div class="integration-status">
                    <div class="integration-item">
                        <i class="fab fa-microsoft"></i>
                        <span>Microsoft 365</span>
                        <span class="status-indicator" id="footer-m365-status">‚óè</span>
                    </div>
                    <div class="integration-item">
                        <i class="fas fa-server"></i>
                        <span>Local Storage</span>
                        <span class="status-indicator connected">‚óè</span>
                    </div>
                    <div class="integration-item">
                        <i class="fas fa-cloud"></i>
                        <span>Cloud Backup</span>
                        <span class="status-indicator" id="footer-backup-status">‚óè</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <p>&copy; 2025 MH Construction Dashboard. Built with modern web technologies for construction professionals.</p>
                <div class="footer-tech">
                    <span>Powered by:</span>
                    <i class="fab fa-html5" title="HTML5"></i>
                    <i class="fab fa-css3-alt" title="CSS3"></i>
                    <i class="fab fa-js-square" title="JavaScript"></i>
                    <i class="fab fa-node-js" title="Node.js"></i>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/data-server.js"></script>
    <script src="js/app.js"></script>
    <script src="js/excel.js"></script>
    <script src="js/emails.js"></script>
    <script>
        // Safe tab switching function
        function showTabSafe(tabName, clickedElement) {
            if (window.dashboard && typeof window.dashboard.showTab === 'function') {
                window.dashboard.showTab(tabName, clickedElement);
            } else {
                // Wait for dashboard to be ready
                setTimeout(() => {
                    if (window.dashboard && typeof window.dashboard.showTab === 'function') {
                        window.dashboard.showTab(tabName, clickedElement);
                    }
                }, 100);
            }
        }
        
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the dashboard
            window.dashboard = new ConstructionDashboard();
        });
    </script>
</body>
</html>
